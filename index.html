<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Font Detective</title>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.5.2/build/reset/reset-min.css" />
		<style>
			
			body {
				font-family: "Lucida Grande", Lucida, Helvetica, Arial, Verdana, sans-serif;
				font-size: 12px;
				background-color: white;
				color: black;
				margin: 0px auto;
				text-align: center;
				width: 900px;
				padding-top: 10px;
				max-width: 100%;
			}
			h1 {
				margin-top: 30px;
				margin-bottom: 30px;
			}
			#content {
				text-align: left;
			}
			
			.sample-text {
				padding: 10px 0;
				border: 1px solid #FFF;
			}
			.sample-text:hover {
				border: 1px dashed #CCC;
			}
			.sample-text:focus {
				border: 1px dashed #555;
			}
			.sample-text * {
				font-family: inherit;
			}
			.sample-font-family {
				position: relative;
				top: -14px;
				left: 0px;
				width: 100%;
				font-family: Monaco, sans-serif;
				font-size: 12px;
			}
			
			@media print {
				.no-print {
					display: none;
				}
			}
			
		</style>
		<meta name="viewport" content="width=device-width" />
	</head>
	<body>
		<h1><img src="img/font-detective.png" alt="Font Detective"/></h1>
		
		<div id="content">
			<div class="no-print">
				<p id="status">Hello</p>
			</div>
		</div>
		
		<script src="lib/jquery.min.js"></script>
		<script src="lib/swfobject.js"></script>
		<script src="lib/coffee-script.js"></script>
		<script src="font-detective.coffee" type="text/coffeescript"></script>	
		<script type="text/coffeescript"> $ ->
			
			statusError = (message)-> $("#status").text(message).css(color: "#a00")
			statusText = (message)-> $("#status").text(message).css(color: "#000")
			E = (t)-> document.createElement t
			
			# Global uncaught error handling
			$(window).on "error", (e)->
				# This shouldn't be needed, but it's good to display any (unforeseen) errors
				# rather than to leave some message like "Loading..." on display (indefinitely)
				err = e.originalEvent
				statusError err.message
			
			statusText "Checking Flash version..."
			unless swfobject.hasFlashPlayerVersion "9.0.0"
				statusError "You don't have a compatible version of Flash installed"
			else
				statusText "Loading... (this may lag your browser for several seconds)"
				
				FontDetective.load (err)->
					statusError err if err
				
				FontDetective.all (fonts)->
					
					statusText "Loaded #{fonts.length} fonts"
					
					text = "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
					size = "32px"
					
					for font in fonts
						$(E("p"))
							.appendTo "#content"
							.addClass "sample-text"
							.text text
							.css
								fontFamily: font
								fontSize: size
							.attr
								contentEditable: yes
							.on "keydown keyup input", (e)->
								# If you've pasted html, make sure there's no font-family styles
								$(@).find("*").css(fontFamily: "")
								# Synchronize this html to other elements
								# (careful not to set the html of this element,
								# as that can mess up the cursor/caret position) 
								$(".sample-text").not(@).html $(@).html()
						
						$(E("div"))
							.appendTo "#content"
							.addClass "sample-font-family"
							.text "#{font}"
				
		</script>
	</body>
</html>
