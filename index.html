<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Font Detective</title>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.5.2/build/reset/reset-min.css" /> 
		<link rel="stylesheet" type="text/css" href="stylesheets/font-detect.css" />  
		<link rel="stylesheet" type="text/css" href="stylesheets/font-detect-print.css" media="print" />
		<meta name="viewport" content="width=device-width" />
	</head>
	<body>
		
		<div id="content">
			<div class="noprint">
				<p id="status">Hello</p>
			</div>
		</div>
		
		<script src="lib/jquery.min.js"></script>
		<script src="lib/swfobject.js"></script>
		<script src="lib/coffee-script.js"></script>
		<script src="font-detective.coffee" type="text/coffeescript"></script>  
		<script type="text/coffeescript"> $ ->
			
			statusError = (message)-> $("#status").text(message).css(color: "#a00")
			statusText = (message)-> $("#status").text(message).css(color: "#000")
			E = (t)-> document.createElement t
			
			# Global uncaught error handling
			$(window).on "error", (e)->
				# This shouldn't be needed, but it's good to display any (unforeseen) errors
				# rather than to leave some message like "Loading..." on display (indefinitely)
				err = e.originalEvent
				statusError err.message
			
			statusText "Checking Flash version..."
			unless swfobject.hasFlashPlayerVersion "9.0.0"
				statusError "You don't have a compatible version of Flash installed"
			else
				statusText "Loading... (this may lag your browser for several seconds)"
				
				FontDetective.load (err)->
					statusError err if err
				
				FontDetective.all (fonts)->
					
					statusText "Loaded #{fonts.length} fonts"
					
					text = "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
					size = "32px"
					
					for font in fonts
						$(E("p"))
							.appendTo "#content"
							.addClass "sample-text"
							.text text
							.css
								fontFamily: font
								fontSize: size
							.attr
								contentEditable: yes
							.on "keydown keyup input", (e)->
								# If you've pasted html, make sure there's no font-family styles
								$(@).find("*").css(fontFamily: "")
								# Synchronize this html to other elements
								# (careful not to set the html of this element,
								# as that can mess up the cursor/caret position) 
								$(".sample-text").not(@).html $(@).html()
						
						$(E("div"))
							.appendTo "#content"
							.addClass "sample-font-family"
							.text "#{font}"
				
		</script>
	</body>
</html>
